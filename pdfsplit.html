<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Page Splitter</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the Inter font and general layout */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* Light grey background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for better content flow */
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 700px;
            text-align: center;
            margin-top: 50px; /* Add some top margin */
        }
        .file-input-label {
            display: inline-block;
            background-color: #4f46e5; /* Indigo 600 */
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .file-input-label:hover {
            background-color: #4338ca; /* Indigo 700 */
        }
        input[type="file"] {
            display: none; /* Hide the default file input */
        }
        .button-primary {
            background-color: #22c55e; /* Green 500 */
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            transition: background-color 0.3s ease;
            font-weight: 600;
            border: none;
            cursor: pointer;
            margin-top: 20px;
        }
        .button-primary:hover {
            background-color: #16a34a; /* Green 600 */
        }
        .button-secondary {
            background-color: #6b7280; /* Gray 500 */
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            transition: background-color 0.3s ease;
            font-weight: 600;
            border: none;
            cursor: pointer;
            margin-top: 10px; /* Slightly less margin for secondary button */
            margin-left: 10px; /* Space between buttons */
        }
        .button-secondary:hover {
            background-color: #4b5563; /* Gray 600 */
        }
        .message-box {
            background-color: #e0f2fe; /* Light blue */
            color: #0c4a6e; /* Dark blue text */
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #7dd3fc; /* Light blue border */
            text-align: left;
            word-wrap: break-word; /* Ensure long messages wrap */
        }
        .error-box {
            background-color: #fee2e2; /* Light red */
            color: #991b1b; /* Dark red text */
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #fca5a5; /* Light red border */
            text-align: left;
            word-wrap: break-word;
        }
        .download-list {
            margin-top: 30px;
            text-align: left;
            max-height: 400px; /* Limit height for scroll */
            overflow-y: auto; /* Enable scrolling */
            padding-right: 10px; /* Space for scrollbar */
        }
        .download-list a {
            display: block;
            background-color: #eef2ff; /* Indigo 50 */
            color: #4338ca; /* Indigo 700 */
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            text-decoration: none;
            transition: background-color 0.2s ease;
            word-wrap: break-word; /* Ensure long filenames wrap */
        }
        .download-list a:hover {
            background-color: #e0e7ff; /* Indigo 100 */
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #4f46e5;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none; /* Hidden by default */
        }
        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px; /* Space between buttons */
            margin-top: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- pdf-lib library for PDF manipulation -->
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
    <!-- JSZip library for creating ZIP files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- FileSaver.js for saving files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">PDF Page Splitter</h1>
        <p class="text-gray-600 mb-8">Select a PDF file to split it into individual pages. Each page will be available for download as a separate PDF.</p>

        <label for="pdfFile" class="file-input-label">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
            Choose PDF File
        </label>
        <input type="file" id="pdfFile" accept=".pdf">

        <p id="fileNameDisplay" class="text-gray-700 text-sm mb-4"></p>

        <div class="button-group">
            <button id="splitButton" class="button-primary" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zm3 8a1 1 0 000 2h6a1 1 0 100-2H7zM4 11a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1z" />
                </svg>
                Split PDF
            </button>
            <button id="downloadAllButton" class="button-secondary" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                Download All (ZIP)
            </button>
        </div>

        <div id="loadingSpinner" class="spinner"></div>
        <div id="messageBox" class="message-box hidden"></div>
        <div id="errorBox" class="error-box hidden"></div>

        <div id="downloadLinks" class="download-list">
            <!-- Download links will be inserted here -->
        </div>
    </div>

    <script>
        // Get references to DOM elements
        const pdfFileInput = document.getElementById('pdfFile');
        const fileNameDisplay = document.getElementById('fileNameDisplay');
        const splitButton = document.getElementById('splitButton');
        const downloadAllButton = document.getElementById('downloadAllButton'); // New button
        const loadingSpinner = document.getElementById('loadingSpinner');
        const messageBox = document.getElementById('messageBox');
        const errorBox = document.getElementById('errorBox');
        const downloadLinksDiv = document.getElementById('downloadLinks');

        let selectedFile = null; // To store the selected PDF file
        let pdfBlobs = [];      // To store PDF blobs for zipping
        let pdfFilenames = [];  // To store filenames for zipping

        // Function to display messages
        function showMessage(message, type = 'info') {
            messageBox.classList.add('hidden');
            errorBox.classList.add('hidden');
            if (type === 'info') {
                messageBox.textContent = message;
                messageBox.classList.remove('hidden');
            } else if (type === 'error') {
                errorBox.textContent = message;
                errorBox.classList.remove('hidden');
            }
        }

        // Event listener for file input change
        pdfFileInput.addEventListener('change', (event) => {
            selectedFile = event.target.files[0];
            if (selectedFile) {
                fileNameDisplay.textContent = `Selected file: ${selectedFile.name}`;
                splitButton.disabled = false; // Enable the split button
                downloadAllButton.disabled = true; // Disable download all until split
                showMessage(''); // Clear any previous messages
                downloadLinksDiv.innerHTML = ''; // Clear previous download links
                pdfBlobs = []; // Clear previous blobs
                pdfFilenames = []; // Clear previous filenames
            } else {
                fileNameDisplay.textContent = '';
                splitButton.disabled = true; // Disable the split button
                downloadAllButton.disabled = true; // Disable download all
            }
        });

        // Event listener for the Split PDF button
        splitButton.addEventListener('click', async () => {
            if (!selectedFile) {
                showMessage('Please select a PDF file first.', 'error');
                return;
            }

            // Show loading spinner and disable buttons
            loadingSpinner.style.display = 'block';
            splitButton.disabled = true;
            downloadAllButton.disabled = true;
            pdfFileInput.disabled = true;
            showMessage('Processing PDF...', 'info');
            downloadLinksDiv.innerHTML = ''; // Clear previous links
            pdfBlobs = []; // Reset blobs for new split operation
            pdfFilenames = []; // Reset filenames for new split operation

            try {
                // Read the selected PDF file as an ArrayBuffer
                const arrayBuffer = await selectedFile.arrayBuffer();
                // Load the PDF document
                const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                const numberOfPages = pdfDoc.getPages().length;

                showMessage(`Splitting PDF with ${numberOfPages} pages...`, 'info');

                const originalFileName = selectedFile.name.replace(/\.pdf$/i, ''); // Get filename without .pdf extension

                // Iterate through each page
                for (let i = 0; i < numberOfPages; i++) {
                    // Create a new PDF document for each page
                    const newPdfDoc = await PDFLib.PDFDocument.create();
                    // Copy the current page from the original PDF to the new PDF
                    const [copiedPage] = await newPdfDoc.copyPages(pdfDoc, [i]);
                    newPdfDoc.addPage(copiedPage);

                    // Save the new single-page PDF
                    const pdfBytes = await newPdfDoc.save();
                    // Create a Blob from the PDF bytes
                    const blob = new Blob([pdfBytes], { type: 'application/pdf' });

                    // Format filename as original_name_page_001.pdf
                    const pageFilename = `${originalFileName}_page_${String(i + 1).padStart(3, '0')}.pdf`;

                    // Store blob and filename for zipping later
                    pdfBlobs.push(blob);
                    pdfFilenames.push(pageFilename);

                    // Create a download link for the generated PDF
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = pageFilename;
                    link.textContent = `Download ${pageFilename}`;
                    downloadLinksDiv.appendChild(link);
                }
                showMessage('PDF split successfully! Download your pages below or download all as a ZIP.', 'info');
                // Enable download all button if pages were split
                if (numberOfPages > 0) {
                    downloadAllButton.disabled = false;
                }

            } catch (error) {
                console.error('Error splitting PDF:', error);
                showMessage(`An error occurred: ${error.message}. Please try again.`, 'error');
            } finally {
                // Hide loading spinner and re-enable button
                loadingSpinner.style.display = 'none';
                splitButton.disabled = false;
                pdfFileInput.disabled = false;
            }
        });

        // Event listener for the Download All button
        downloadAllButton.addEventListener('click', async () => {
            if (pdfBlobs.length === 0) {
                showMessage('No PDF pages to download. Please split a PDF first.', 'error');
                return;
            }

            loadingSpinner.style.display = 'block';
            splitButton.disabled = true;
            downloadAllButton.disabled = true;
            pdfFileInput.disabled = true;
            showMessage('Creating ZIP file...', 'info');

            try {
                const zip = new JSZip();
                const originalFileName = selectedFile.name.replace(/\.pdf$/i, '');

                // Add each PDF blob to the zip file
                pdfBlobs.forEach((blob, index) => {
                    zip.file(pdfFilenames[index], blob);
                });

                // Generate the ZIP file
                const zipBlob = await zip.generateAsync({ type: "blob" });

                // Save the ZIP file using FileSaver.js
                saveAs(zipBlob, `${originalFileName}_split_pages.zip`);

                showMessage('ZIP file created and download initiated!', 'info');

            } catch (error) {
                console.error('Error creating ZIP file:', error);
                showMessage(`An error occurred while zipping: ${error.message}.`, 'error');
            } finally {
                loadingSpinner.style.display = 'none';
                splitButton.disabled = false;
                pdfFileInput.disabled = false;
                downloadAllButton.disabled = false; // Re-enable after zipping attempt
            }
        });
    </script>
</body>
</html>
